--- /usr/share/lipstick-jolla-home-qt5/lockscreen/Clock.qml	2017-04-06 20:24:08.131160949 +0200
+++ /usr/share/lipstick-jolla-home-qt5/lockscreen/Clock.qml	2017-04-06 20:25:56.706243680 +0200
@@ -11,6 +11,8 @@
 import org.nemomobile.time 1.0
 import org.nemomobile.lipstick 0.1
 import "../main"
+import "../eventsview/weather"
+import org.nemomobile.configuration 1.0
 
 Item {
     id: clock
@@ -21,52 +23,116 @@
     property alias updatesEnabled: timeText.updatesEnabled
     readonly property bool largeScreen: Screen.sizeCategory >= Screen.Large
 
-    width: Math.max(timeText.width, weekday.width, month.width)
-    height: timeText.font.pixelSize + weekday.font.pixelSize + month.font.pixelSize + Theme.paddingMedium * 2
-    baselineOffset: timeText.y + timeText.baselineOffset
+    width: Math.max(timeText.width, timeTextHours.width, timeTextMin.width, weekday.width)
+    height: timeText.font.pixelSize +timeTextMin.font.pixelSize + weekday.font.pixelSize + Theme.paddingMedium * 2
+    baselineOffset: timeTextMin.y + timeTextMin.baselineOffset
+
+    function hours12()
+    {
+    var hours = Qt.formatTime(new Date(), "hh")  % 12 || 12
+    hours = hours < 10 ? '0'+hours : hours
+    return hours
+    }
+
+    ConfigurationGroup {
+        id: xperiaclock
+        path: "/desktop/lipstick/sailfishos-patch-xperia-clock"
+        property bool ampm: false
+        property real hsize: 3.5
+        property real hmargin: 2
+        property color hcolor: Theme.primaryColor
+        property real msize: 3.5
+        property real mmargin: 1
+        property color mcolor: Theme.primaryColor
+        property real daysize: 40
+        property real daymargin: 1
+        property color daycolor: Theme.primaryColor
+        property bool weatherenabled: false
+        property int weatherscale: 100
+    }
 
     ClockItem {
         id: timeText
-        color: Theme.primaryColor
+	visible: false
+        color: xperiaclock.hcolor
+        // Ascender of the time to the top of the clock.
+        anchors {
+            bottom: parent.top
+            bottomMargin: -timeText.font.pixelSize + Theme.paddingLarge * xperiaclock.hmargin
+            horizontalCenter: parent.horizontalCenter
+        }
+        font { pixelSize: Theme.fontSizeHuge * xperiaclock.hsize; family: Theme.fontFamilyHeading }
+        text: Qt.formatTime(new Date(), "hh")
+    }
+
+    ClockItem {
+        id: timeTextHour
+        color: xperiaclock.hcolor
+        // Ascender of the time to the top of the clock.
+        anchors {
+            bottom: parent.top
+            bottomMargin: -timeTextHour.font.pixelSize + Theme.paddingLarge * xperiaclock.hmargin
+            horizontalCenter: parent.horizontalCenter
+        }
+        font { pixelSize: Theme.fontSizeHuge * xperiaclock.hsize; family: Theme.fontFamilyHeading }
+        text: xperiaclock.ampm ? hours12() : Qt.formatTime(new Date(), "hh");
+    }
+
+    ClockItem {
+        id: timeTextMin
+        color: xperiaclock.mcolor
         // Ascender of the time to the top of the clock.
         anchors {
+            top: timeTextHour.baseline
+            topMargin: -Theme.paddingLarge * xperiaclock.mmargin
             bottom: parent.top
-            bottomMargin: -timeText.font.pixelSize
+            bottomMargin: -timeTextHour.font.pixelSize
             horizontalCenter: parent.horizontalCenter
         }
-        font { pixelSize: largeScreen ? Theme.fontSizeHuge * 2.0 : Math.round(128 * Screen.widthRatio); family: Theme.fontFamilyHeading }
+        font { pixelSize: Theme.fontSizeHuge * xperiaclock.msize; family: Theme.fontFamilyHeading }
+        text: Qt.formatTime(new Date(), "mm")
     }
 
     Connections {
         target: Lipstick.compositor
-        onDisplayAboutToBeOn: timeText.forceUpdate()
+        onDisplayAboutToBeOn: { 
+		timeTextHour.text = xperiaclock.ampm ? hours12() : Qt.formatTime(new Date(), "hh");
+
+		timeTextMin.text = Qt.formatTime(new Date(), "mm")  
+	}
     }
 
     Text {
         id: weekday
         anchors {
             horizontalCenter: parent.horizontalCenter
-            top: timeText.baseline
-            topMargin: Theme.paddingMedium
+            top: timeTextMin.baseline
+            topMargin: Theme.paddingMedium * xperiaclock.daymargin
         }
-        color: timeText.color
-        font { pixelSize: largeScreen ? Theme.fontSizeLarge : Math.round(40 * Screen.widthRatio); family: Theme.fontFamily }
+        color: xperiaclock.daycolor
+        font { pixelSize: largeScreen ? Theme.fontSizeLarge : Math.round(xperiaclock.daysize * Screen.widthRatio); family: Theme.fontFamily }
         text: {
             var day = Format.formatDate(time, Format.WeekdayNameStandalone)
-            return day[0].toUpperCase() + day.substring(1)
+            var month = Format.formatDate(time, Format.DateMediumWithoutYear)
+        if(xperiaclock.ampm){
+            var hour = Qt.formatTime(new Date(), "hh")
+            var ampm = hour >= 12 ? 'pm' : 'am';
+            return ampm.toUpperCase() + " - " + day.substring(0, 3).toUpperCase() + ", " + month.toUpperCase();
+        } else {
+            return day.substring(0, 3).toUpperCase() + ", " + month.toUpperCase();
         }
-    }
-
-    Text {
-        id: month
-        anchors {
-            horizontalCenter: parent.horizontalCenter
-            top: weekday.baseline
-            topMargin: Theme.paddingMedium
         }
-        color: timeText.color
-        font { pixelSize: largeScreen ? Theme.fontSizeExtraLarge * 1.1 : Math.round(55 * Screen.widthRatio); family: Theme.fontFamily }
-
-        text: Format.formatDate(time, Format.DateMediumWithoutYear)
     }
+	WeatherLoader {
+        id: weatherWidget
+		visible: xperiaclock.weatherenabled
+		active: true
+		scale: xperiaclock.weatherscale/100
+	    anchors {
+			top: weekday.bottom
+			horizontalCenter: parent.horizontalCenter
+		}	
+		width: lockScreen.width
+    }
+
 }
